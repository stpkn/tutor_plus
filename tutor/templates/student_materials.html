<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã - –ö–∞–±–∏–Ω–µ—Ç —É—á–µ–Ω–∏–∫–∞</title>
    <link rel="stylesheet" href="/styles.css">
    <style>
        .dashboard-title {
            color: #FEFCF8 !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header-info h1 {
            color: #FEFCF8;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header-info h2 {
            color: #FEFCF8;
            opacity: 0.9;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .subtitle {
            color: #FEFCF8;
            opacity: 0.8;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .materials-container {
            padding: 20px;
        }

        .materials-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #FEFCF8, #F5F0E8);
            border-radius: 15px;
            border: 2px solid #88746b;
            position: relative;
            overflow: hidden;
        }

        .materials-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #88746b, #6B5B73);
        }

        .filter-search {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .filter-select {
            padding: 10px 15px;
            border: 2px solid #88746b;
            border-radius: 20px;
            background: white;
            color: #88746b;
            font-weight: 600;
            cursor: pointer;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: white;
            border: 2px solid #88746b;
            border-radius: 20px;
            padding: 5px 15px;
        }

        .search-box input {
            border: none;
            outline: none;
            padding: 8px;
            font-size: 1em;
            width: 200px;
        }

        .materials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .material-card {
            background: linear-gradient(135deg, #FEFCF8, #F5F0E8);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #88746b;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .material-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #88746b, #6B5B73);
        }

        .material-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(136, 116, 107, 0.2);
        }

        .material-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .material-header h4 {
            color: #88746b;
            margin: 0;
            font-size: 1.3em;
            flex: 1;
        }

        .material-type {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            color: white;
        }

        .type-pdf { background: linear-gradient(135deg, #ff6b6b, #fa5252); }
        .type-presentation { background: linear-gradient(135deg, #339af0, #228be6); }
        .type-document { background: linear-gradient(135deg, #51cf66, #40c057); }
        .type-video { background: linear-gradient(135deg, #cc5de8, #be4bdb); }
        .type-archive { background: linear-gradient(135deg, #868e96, #495057); }

        .material-info {
            margin-bottom: 20px;
        }

        .material-info p {
            margin: 8px 0;
            color: #666;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .material-description {
            color: #666;
            line-height: 1.5;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(136, 116, 107, 0.05);
            border-radius: 10px;
            border-left: 3px solid #88746b;
        }

        .material-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .btn-download {
            background: linear-gradient(135deg, #51cf66, #40c057);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(81, 207, 102, 0.4);
        }

        .btn-preview {
            background: linear-gradient(135deg, #339af0, #228be6);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-preview:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(51, 154, 240, 0.4);
        }

        .empty-materials {
            text-align: center;
            padding: 60px 20px;
            color: #666;
            grid-column: 1 / -1;
        }

        .empty-materials .icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .loading-materials {
            text-align: center;
            padding: 60px 20px;
            color: #666;
            grid-column: 1 / -1;
        }

        .loading-icon {
            font-size: 3em;
            margin-bottom: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .materials-header {
                flex-direction: column;
                gap: 20px;
            }

            .filter-search {
                flex-direction: column;
                width: 100%;
            }

            .search-box input {
                width: 100%;
            }

            .materials-grid {
                grid-template-columns: 1fr;
            }

            .material-header {
                flex-direction: column;
                gap: 10px;
            }

            .material-actions {
                justify-content: stretch;
            }

            .material-actions button {
                flex: 1;
                min-width: 120px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="navbar">
            <div class="nav-brand">
                <span>üìö –ö–∞–±–∏–Ω–µ—Ç —É—á–µ–Ω–∏–∫–∞</span>
            </div>
            <ul class="nav-menu">
                <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="/cabinet">–í—ã–π—Ç–∏</a></li>
            </ul>
        </nav>

        <div class="main-container">
            <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
            <div class="sidebar">
                <div class="sidebar-header">
                    <h3 class="dashboard-title">–ü–∞–Ω–µ–ª—å —É—á–µ–Ω–∏–∫–∞</h3>
                </div>
                <ul class="sidebar-menu">
                    <li class="menu-item">
                        <a href="/student-cabinet" style="display: block; text-decoration: none; color: inherit;">
                            üìä –û–±–∑–æ—Ä
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="/student-schedule" style="display: block; text-decoration: none; color: inherit;">
                            üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                        </a>
                    </li>
                    <li class="menu-item active">
                        <a href="/student-materials" style="display: block; text-decoration: none; color: inherit;">
                            üìö –ú–∞—Ç–µ—Ä–∏–∞–ª—ã
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="/student-tests" style="display: block; text-decoration: none; color: inherit;">
                            üß™ –¢–µ—Å—Ç—ã
                        </a>
                    </li>
                </ul>
            </div>

            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
            <div class="content-area">
                <header class="header">
                    <div class="header-info">
                        <h1>üìö –£—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</h1>
                        <h2>–†–µ—Å—É—Ä—Å—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è</h2>
                        <p class="subtitle">–î–æ—Å—Ç—É–ø –∫ —É—á–µ–±–Ω—ã–º –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º –æ—Ç –≤–∞—à–µ–≥–æ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞</p>
                    </div>
                </header>

                <section class="materials-container">

                    <!-- –°–µ—Ç–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ -->
                    <div class="materials-grid" id="materialsGrid">
                        <div class="loading-materials">
                            <div class="loading-icon">‚è≥</div>
                            <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤...</h3>
                            <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ.</p>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <script>
        let allMaterials = [];

        // –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadMaterials();

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
            document.getElementById('categoryFilter').addEventListener('change', filterMaterials);
            document.getElementById('searchInput').addEventListener('input', filterMaterials);
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function loadMaterials() {
            const materialsGrid = document.getElementById('materialsGrid');

            try {
                materialsGrid.innerHTML = `
                    <div class="loading-materials">
                        <div class="loading-icon">‚è≥</div>
                        <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤...</h3>
                        <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ.</p>
                    </div>
                `;

                const response = await fetch('/api/materials');
                const data = await response.json();

                if (data.success) {
                    allMaterials = data.materials;
                    renderMaterials(allMaterials);
                } else {
                    showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:', error);
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤');
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
        function renderMaterials(materials) {
            const materialsGrid = document.getElementById('materialsGrid');

            if (!materials || materials.length === 0) {
                materialsGrid.innerHTML = `
                    <div class="empty-materials">
                        <div class="icon">üìö</div>
                        <h3>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</h3>
                        <p>–†–µ–ø–µ—Ç–∏—Ç–æ—Ä –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–∏–ª —É—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã.</p>
                        <p>–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º.</p>
                    </div>
                `;
                return;
            }

            let materialsHTML = '';

            materials.forEach(material => {
                const typeClass = getTypeClass(material.file_type);
                const typeText = getTypeText(material.file_type);
                const examType = material.exam_type === 'oge' ? '–û–ì–≠' :
                               material.exam_type === 'ege' ? '–ï–ì–≠' : '–û–ì–≠/–ï–ì–≠';

                materialsHTML += `
                    <div class="material-card">
                        <div class="material-header">
                            <h4>${material.title}</h4>
                            <span class="material-type ${typeClass}">${typeText}</span>
                        </div>
                        <div class="material-info">
                            <p>üìÑ ${material.file_type.toUpperCase()} –¥–æ–∫—É–º–µ–Ω—Ç</p>
                            <p>üìè –†–∞–∑–º–µ—Ä: ${material.file_size}</p>
                            <p>üìÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: ${formatDate(material.created_at)}</p>
                            <p>üéØ –î–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏: ${examType}</p>
                        </div>
                        ${material.description ? `
                        <div class="material-description">
                            ${material.description}
                        </div>
                        ` : ''}
                        <div class="material-actions">
                            ${material.file_path ? `
                            <button class="btn-download" onclick="downloadMaterial(${material.id})">
                                üì• –°–∫–∞—á–∞—Ç—å
                            </button>
                            <button class="btn-preview" onclick="previewMaterial(${material.id})">
                                üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å
                            </button>
                            ` : `
                            <button class="btn-download" disabled>
                                üì• –§–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
                            </button>
                            `}
                        </div>
                    </div>
                `;
            });

            materialsGrid.innerHTML = materialsHTML;
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
        function filterMaterials() {
            const category = document.getElementById('categoryFilter').value;
            const searchText = document.getElementById('searchInput').value.toLowerCase();

            let filteredMaterials = allMaterials;

            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            if (category !== 'all') {
                filteredMaterials = filteredMaterials.filter(material =>
                    material.category === category
                );
            }

            // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏ –æ–ø–∏—Å–∞–Ω–∏—é
            if (searchText) {
                filteredMaterials = filteredMaterials.filter(material =>
                    material.title.toLowerCase().includes(searchText) ||
                    (material.description && material.description.toLowerCase().includes(searchText))
                );
            }

            renderMaterials(filteredMaterials);
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function getTypeClass(fileType) {
            const typeMap = {
                'pdf': 'type-pdf',
                'ppt': 'type-presentation',
                'pptx': 'type-presentation',
                'doc': 'type-document',
                'docx': 'type-document',
                'mp4': 'type-video',
                'avi': 'type-video',
                'zip': 'type-archive',
                'rar': 'type-archive'
            };
            return typeMap[fileType] || 'type-document';
        }

        function getTypeText(fileType) {
            const typeMap = {
                'pdf': 'PDF',
                'ppt': '–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è',
                'pptx': '–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è',
                'doc': '–î–æ–∫—É–º–µ–Ω—Ç',
                'docx': '–î–æ–∫—É–º–µ–Ω—Ç',
                'mp4': '–í–∏–¥–µ–æ',
                'avi': '–í–∏–¥–µ–æ',
                'zip': '–ê—Ä—Ö–∏–≤',
                'rar': '–ê—Ä—Ö–∏–≤'
            };
            return typeMap[fileType] || '–î–æ–∫—É–º–µ–Ω—Ç';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU');
        }

        function downloadMaterial(materialId) {
            alert(`–ù–∞—á–∞—Ç–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ #${materialId}`);
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
        }

        function previewMaterial(materialId) {
            alert(`–ü—Ä–æ—Å–º–æ—Ç—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–∞ #${materialId}`);
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–∞–π–ª–∞
        }

        function showError(message) {
            const materialsGrid = document.getElementById('materialsGrid');
            materialsGrid.innerHTML = `
                <div class="empty-materials">
                    <div class="icon">‚ùå</div>
                    <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>
                    <p>${message}</p>
                    <button class="btn-download" onclick="loadMaterials()" style="margin-top: 15px;">
                        üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                    </button>
                </div>
            `;
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        fetch('/api/check-auth')
            .then(response => response.json())
            .then(data => {
                if (!data.authenticated || data.user.role !== 'student') {
                    window.location.href = '/cabinet';
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
            });

        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(loadMaterials, 30000);
    </script>
</body>
</html>